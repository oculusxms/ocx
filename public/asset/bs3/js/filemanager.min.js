function s(t){if(t.success){$("#dialog").modal("hide");var e=$.tree.focused();e.select_branch(e.selected),$("#notification").html($("<div>",{"class":"alert alert-success"}).html(t.success))}t.error&&$("#notification").html($("<div>",{"class":"alert alert-danger"}).html(t.error))}!function(t){function e(){return{cntr:++e.cntr,settings:t.extend({},t.tree.defaults),init:function(i,n){return this.container=t(i),0==this.container.size?!1:(e.inst[this.cntr]=this,this.container.attr("id")||this.container.attr("id","jstree_"+this.cntr),e.inst[this.container.attr("id")]=e.inst[this.cntr],e.focused=this.cntr,this.settings=t.extend(!0,{},this.settings,n),this.container.addClass("tree"),this.offset=!1,this.callback("oninit",[this]),this.refresh(),this.attach_events(),void this.focus())},refresh:function(e){var i=this;if(this.is_partial_refresh=e?!0:!1,this.opened=Array(),0!=this.settings.opened?(t.each(this.settings.opened,function(){this.replace(/^#/,"").length>0&&i.opened.push("#"+this.replace(/^#/,""))}),this.settings.opened=!1):this.container.find("li.open").each(function(){this.id&&i.opened.push("#"+this.id)}),this.selected)this.settings.selected=Array(),e?t(e).find("li:has(a.clicked)").each(function(){this.id&&i.settings.selected.push("#"+this.id)}):this.selected_arr?t.each(this.selected_arr,function(){this.attr("id")&&i.settings.selected.push("#"+this.attr("id"))}):this.selected.attr("id")&&this.settings.selected.push("#"+this.selected.attr("id"));else if(this.settings.selected!==!1){var n=Array();"object"==(typeof this.settings.selected).toLowerCase()?t.each(this.settings.selected,function(){this.replace(/^#/,"").length>0&&n.push("#"+this.replace(/^#/,""))}):this.settings.selected.replace(/^#/,"").length>0&&n.push("#"+this.settings.selected.replace(/^#/,"")),this.settings.selected=n}if(e)return this.opened=Array(),e=this.get_node(e),e.find("li.open").each(function(){i.opened.push("#"+this.id)}),e.hasClass("open")&&e.removeClass("open").addClass("closed"),e.hasClass("leaf")&&e.removeClass("leaf"),e.children("ul:eq(0)").html(""),this.open_branch(e,!0,function(){i.reselect.apply(i)});var i=this,s=new t.tree.datastores.json;0==this.container.children("ul").size()&&this.container.html('<ul class="nav"><li><i class="icon-load"></i> loading...</li></ul>'),s.load(this.callback("beforedata",[!1,this]),this,this.settings.data.opts,function(e){s.parse(e,i,i.settings.data.opts,function(e){i.container.empty().append(t("<ul class='nav'>").html(e)),i.container.find("li:last-child").end().find("li:has(ul)").not(".open").addClass("closed"),i.container.find("li").not(".open").not(".closed").addClass("leaf"),i.reselect()})})},reselect:function(e){var i=this;if(e?this.cl_count--:this.cl_count=0,this.opened&&this.opened.length){for(var n=!1,s=0;this.opened&&s<this.opened.length;s++){var a=this.get_node(this.opened[s]);if(a.size()&&a.hasClass("closed")>0){n=!0;var a=this.opened[s].toString().replace("/","\\/");delete this.opened[s],this.open_branch(a,!0,function(){i.reselect.apply(i,[!0])}),this.cl_count++}}if(n)return;if(this.cl_count>0)return;delete this.opened}this.cl_count>0||(this.scrtop&&(this.container.scrollTop(i.scrtop),delete this.scrtop),this.settings.selected!==!1&&(t.each(this.settings.selected,function(e){i.select_branch(i.is_partial_refresh?t(i.settings.selected[e].toString().replace("/","\\/"),i.container):t(i.settings.selected[e].toString().replace("/","\\/"),i.container))}),this.settings.selected=!1))},get:function(e,i,n){return i||(i="json"),n||(n=this.settings.data.opts),(new t.tree.datastores[i]).get(e,this,n)},attach_events:function(){var e=this;this.container.bind("mousedown.jstree",function(){}).bind("mouseup.jstree",function(){setTimeout(function(){e.focus.apply(e)},5)}).bind("click.jstree",function(){return!0}),t(document).on("click","#"+this.container.attr("id")+" li",function(i){return"LI"!=i.target.tagName?!0:i.pageY-t(i.target).offset().top>e.li_height?!0:(e.toggle_branch.apply(e,[i.target]),i.stopPropagation(),!1)}),t(document).on("click.jstree","#"+this.container.attr("id")+" li a",function(t){return t.which&&3==t.which?!0:(e.select_branch.apply(e,[t.target,t.ctrlKey]),e.inp&&e.inp.blur(),t.preventDefault(),t.target.blur(),!1)})},focus:function(){e.focused!=this.cntr&&(e.focused=this.cntr)},scroll_check:function(t,e){var i=this,n=i.container,s=i.container.offset(),a=n.scrollTop(),r=n.scrollLeft(),l=n.get(0).scrollWidth>n.width()?40:20;e-s.top<20&&n.scrollTop(Math.max(a-4,0)),n.height()-(e-s.top)<l&&n.scrollTop(a+4),t-s.left<20&&n.scrollLeft(Math.max(r-4,0)),n.width()-(t-s.left)<40&&n.scrollLeft(r+4)},get_node:function(e){return t(e).closest("li")},select_branch:function(t){var e=this;return t=e.get_node(t),t.size()?(t.children("a").removeClass("hover"),this.selected&&this.selected.children("A").removeClass("clicked"),this.selected=t,this.selected.children("a").addClass("clicked").end().parents("li.closed").each(function(){e.open_branch(this,!0)}),void this.callback("onselect",[this.selected.get(0),e])):this.error("SELECT:NOT A VALID a")},deselect_branch:function(t){var t=this.get_node(t);return 0==t.children("a.clicked").size()?this.error("DESELECT:a NOT SELECTED"):void t.children("a").removeClass("clicked")},toggle_branch:function(t){var t=this.get_node(t);return t.hasClass("closed")?this.open_branch(t):t.hasClass("open")?this.close_branch(t):void 0},open_branch:function(e,i,n){var s=this,e=this.get_node(e);if(!e.size())return this.error("OPEN:NO SUCH a");if(e.hasClass("leaf"))return this.error("OPEN:OPENING LEAF a");if(0==e.find("li").size()){e.children("ul:eq(0)").remove().end().append('<ul class="nav"><li><i class="icon-load"></i> loading...</li></ul>'),e.removeClass("closed").addClass("open");var a=new t.tree.datastores.json;return a.load(this.callback("beforedata",[e,this]),this,this.settings.data.opts,function(i){return i&&0!=i.length?void a.parse(i,s,s.settings.data.opts,function(i){e.children("ul:eq(0)").replaceWith(t("<ul class='nav'>").html(i)),e.find("li:last-child").end().find("li:has(ul)").not(".open").addClass("closed"),e.find("li").not(".open").not(".closed").addClass("leaf"),s.open_branch.apply(s,[e]),n&&n.call()}):(e.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),void(n&&n.call()))}),!0}return e.removeClass("closed").addClass("open"),n&&n.call(),!0},close_branch:function(t){var t=this.get_node(t);return t.size()?void(t.hasClass("open")&&t.removeClass("open").addClass("closed")):this.error("CLOSE:NO SUCH a")},parent:function(t){return t=this.get_node(t),t.size()?t.parents("li:eq(0)").size()?t.parents("li:eq(0)"):-1:!1},children:function(t){return-1===t?this.container.children("ul:eq(0)").children("li"):(t=this.get_node(t),t.size()?t.children("ul:eq(0)").children("li"):!1)},callback:function(t,e){var i=!1;return i=this.settings.callback[t],"function"==typeof i?i.apply(null,e):void 0},error:function(t){return this.callback("error",[t,this]),!1}}}t.tree={datastores:{},defaults:{data:{opts:{url:!1}},selected:"top",opened:["top"],callback:{beforedata:function(e,i){return 0==e?(i.settings.data.opts.static=[{data:"image",attributes:{id:"top",directory:""},state:"closed"}],{directory:""}):(i.settings.data.opts.static=!1,{directory:t(e).attr("directory")})},onselect:function(){},error:function(){},oninit:function(){}}},focused:function(){return e.inst[e.focused]}},t.fn.tree=function(i){return this.each(function(){var n=t.extend({},i);e.inst&&e.inst[t(this).attr("id")]&&e.inst[t(this).attr("id")].destroy(),n!==!1&&(new e).init(this,n)})},e.inst={},t.extend(t.tree.datastores,{json:function(){return{get:function(e,i,n){var s=this;if(e=e&&0!=t(e).size()?t(e):i.container.children("ul").children("li"),n||(n={}),n.outer_attrib||(n.outer_attrib=["id","rel","class"]),n.inner_attrib||(n.inner_attrib=[]),e.size()>1){var a=[];return e.each(function(){a.push(s.get(this,i,n))}),a}if(0==e.size())return[];var r={attributes:{},data:{}};e.hasClass("open")&&(r.data.state="open"),e.hasClass("closed")&&(r.data.state="closed");for(var l in n.outer_attrib)if(n.outer_attrib.hasOwnProperty(l)){var o="class"==n.outer_attrib[l]?e.attr(n.outer_attrib[l]).replace(/(^| )last( |$)/gi," ").replace(/(^| )(leaf|closed|open)( |$)/gi," "):e.attr(n.outer_attrib[l]);"undefined"!=typeof o&&o.toString().replace(" ","").length>0&&(r.attributes[n.outer_attrib[l]]=o),delete o}var c=e.children("a");if(n.inner_attrib.length){r.data.attributes={};for(var d in n.inner_attrib)if(n.inner_attrib.hasOwnProperty(d)){var o=c.attr(n.inner_attrib[d]);"undefined"!=typeof o&&o.toString().replace(" ","").length>0&&(r.data.attributes[n.inner_attrib[d]]=o),delete o}}return e.children("ul").size()>0&&(r.children=[],e.children("ul").children("li").each(function(){r.children.push(s.get(this,i,n))})),r},parse:function(t,e,i,n){if("[object Array]"===Object.prototype.toString.apply(t)){for(var s="",a=0;a<t.length;a++)"function"!=typeof t[a]&&(s+=this.parse(t[a],e,i));return n&&n.call(null,s),s}if(!t||!t.data)return n&&n.call(null,!1),"";var s="<li ",r=!1;if(t.attributes)for(var a in t.attributes)t.attributes.hasOwnProperty(a)&&(s+=" "+a+"='"+t.attributes[a]+"' ");r||"closed"!=t.state&&"open"!=t.state||(s+=" class='"+t.state+"' "),s+=">";var l={};if(l.href="","undefined"!=(typeof t.data.attributes).toLowerCase())for(var a in t.data.attributes)t.data.attributes.hasOwnProperty(a)&&(l[a]=t.data.attributes[a]);if(s+='<a><i class="icon-folder-close"></i> ',s+=("undefined"!=(typeof t.data.title).toLowerCase()?t.data.title:t.data)+"</a>",t.children&&t.children.length){s+='<ul class="nav">';for(var a=0;a<t.children.length;a++)s+=this.parse(t.children[a],e,i);s+="</ul>"}return s+="</li>",n&&n.call(null,s),s},load:function(e,i,n,s){n.static?s.call(null,n.static):t.ajax({type:"POST",url:n.url,data:e,dataType:"json",success:function(t){s.call(null,t)},error:function(t,e,n){s.call(null,!1),i.error(n+" "+e)}})}}}})}(jQuery),$(document).ajaxError(function(t,e,i,n){$("#notification").html($("<div>",{"class":"alert alert-danger"}).html(n+"\r\n"+e.statusText))}),function(){var t=$.event.special,e="D"+ +new Date,i="D"+(+new Date+1);t.scrollstart={setup:function(){var i,n=function(e){var n=this,s=arguments;i?clearTimeout(i):(e.type="scrollstart",$.event.handle.apply(n,s)),i=setTimeout(function(){i=null},t.scrollstop.latency)};$(this).bind("scroll",n).data(e,n)},teardown:function(){$(this).unbind("scroll",$(this).data(e))}},t.scrollstop={latency:0,setup:function(){var e,n=function(i){var n=this,s=arguments;e&&clearTimeout(e),e=setTimeout(function(){e=null,i.type="scrollstop",$.event.handle.apply(n,s)},t.scrollstop.latency)};$(this).bind("scroll",n).data(i,n)},teardown:function(){$(this).unbind("scroll",$(this).data(i))}}}(),function(t){var e;t.fn.ajaxUpload=function(i){var n=t.extend({accept:["*"],name:"file",method:"POST",url:"/",data:!1,onSubmit:function(){return!0},onComplete:function(){return!0}},i);return this.each(function(){var i=t(this);i.css("position","relative"),i.setData=function(t){n.data=t};var s=t('<form style="margin:0px !important;padding:0px !important;position:absolute;top:0px;left:0px;" method="'+n.method+'" enctype="multipart/form-data" action="'+n.url+'"> <input name="'+n.name+'" type="file" /></form>'),a=s.find("input[name="+n.name+"]");a.css("display","block"),a.css("overflow","hidden"),a.css("width","100%"),a.css("height","100%"),a.css("text-align","right"),a.css("opacity","0"),a.css("z-index","999999"),a.change(function(){s.find("input[type=hidden]").remove(),n.onSubmit.call(i,t(this)),n.data&&t.each(n.data,function(e,i){s.append(t('<input type="hidden" name="'+e+'" value="'+i+'">'))}),s.submit(),t(s).find("input[type=file]").attr("disabled","disabled")}),t(i).append(s),e||(e=t('<iframe id="__ajaxUploadIFRAME" name="__ajaxUploadIFRAME"></iframe>').attr("style",'style="width:0px;height:0px;border:0px solid #fff;"').hide(),e.attr("src",""),t(document.body).append(e));var r=function(){t(s).find("input[type=file]").removeAttr("disabled");var a=t(this).contents().find("html body").text();n.onComplete.call(i,a),e.unbind()};s.submit(function(t){e.load(r),s.attr("target","__ajaxUploadIFRAME"),t.stopPropagation()})})}}(jQuery),$(function(){$("#refresh").bind("click",function(){var t=$.tree.focused();t.refresh(t.selected)})});