function getURLVar(e){var t=String(document.location).toLowerCase().split("?"),o="";if(t[1])for(var n=t[1].split("&"),a=0;a<=n.length;a++)if(n[a]){var r=n[a].split("=");r[0]&&r[0]==e.toLowerCase()&&(o=r[1])}return o}function filter(){url="index.php?route="+getURLVar("route")+"&token="+token,$("#filter").find("select,:text").each(function(){var e=$(this).val();e&&"*"!=e&&(url+="&"+$(this).attr("name")+"="+encodeURIComponent(e))}),location=url}function attributeautocomplete(e){var t={};$('input[name="product_attribute['+e+'][name]"]').typeahead({source:function(e,o){return $.getJSON("index.php?route=catalog/attribute/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,o){t[o.name]=o.attribute_id,n.push(o.name)}),o(n)})},updater:function(o){return $('input[name="product_attribute['+e+'][attribute_id]"]').val(t[o]),o}}).click(function(){this.select()})}function image_upload(e,t){$("#modal .modal-body").html('<iframe src="index.php?route=common/filemanager&token='+token+"&field="+encodeURIComponent(e)+'" frameborder="no" scrolling="auto"></iframe>'),$("#modal").on("hidden.bs.modal",function(){$("#"+e).val()&&$.ajax({url:"index.php?route=common/filemanager/image&token="+token+"&image="+encodeURIComponent($("#"+e).val()),dataType:"text",success:function(e){$("#"+t).attr({src:e,id:t})}})}).modal("show")}function sendVoucher(e,t){$.ajax({url:"index.php?route=sale/voucher/send&token="+token+"&voucher_id="+e,type:"post",dataType:"json",beforeSend:function(){alertMessage("warning",t)},success:function(e){e.error&&alertMessage("danger",e.error),e.success&&alertMessage("success",e.success)}})}token=getURLVar("token"),route=getURLVar("route"),route?(part=route.split("/"),part[1]&&$('a[href*="'+part[0]+"/"+part[1]+'"]').parents("li[id]").addClass("active")):$("#dashboard").addClass("active"),!function(e){var t=function(t,o){o=e.extend({},e.fn.rowlink.defaults,o);var n="tr"==t.nodeName.toLowerCase()?e(t):e(t).find("tr:not(#filter):has(td)").not(".rowlink-skip");n.each(function(){var t=e(this).find(o.target).first();if(t.length){var n=t.attr("href");e(this).find("td").not(".rowlink-skip").click(function(e){"rowlink-skip"!=e.target.className&&(window.location=n)}),e(this).addClass("rowlink")}})};e.fn.rowlink=function(o){return this.each(function(){var n=e(this),a=n.data("rowlink");a||n.data("rowlink",a=new t(this,o))})},e.fn.rowlink.defaults={target:"a:not([target]):not([onclick])"},e.fn.rowlink.Constructor=t,e(function(){e('[data-link="row"]').each(function(){e(this).rowlink(e(this).data())})})}(window.jQuery),$(document).ajaxError(function(e,t,o,n){$("#notification").html($("<div>",{"class":"alert alert-danger"}).html(n+"\r\n"+t.statusText))}),$(document).ready(function(){function e(e,t,o){var n=new FormData;n.append("image",e),n.append("directory","content"),$.ajax({url:"index.php?route=common/filemanager/editor_upload&token="+token,data:n,cache:!1,contentType:!1,processData:!1,dataType:"json",type:"POST",success:function(e){e.success?t.insertImage(o,e.success):alert(e.error)},error:function(e,t,o){console.log(t+" "+o)}})}$(".summernote").summernote({height:200,minHeight:null,maxHeight:null,focus:!0,toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link","picture","video","hr"]],["view",["codeview"]],["help",["help"]]],onImageUpload:function(t,o,n){e(t[0],o,n)}}),$(document).on("click",".note-editor .dropdown-menu a",function(e){e.preventDefault()}),$(".dropdown-submenu a").on("touchstart click",function(e){e.stopPropagation()}),$("#btn-delete").on("click",function(e){e.preventDefault(),confirm(text_confirm)&&$("#form").attr("action",$(this).attr("formaction")).submit()}),$("a").click(function(){return null==$(this).attr("href")||-1==$(this).attr("href").indexOf("uninstall",1)||confirm(text_confirm)?void 0:!1}),$('[data-toggle="selected"]').click(function(){$('input[name^="selected"]').prop("checked",this.checked)}),$(document).on("focus",".datetime",function(){$(this).datetimepicker({todayBtn:1,autoclose:1,minView:0,showMeridian:1,format:"yyyy-mm-dd hh:mm",pickerPosition:"bottom-left"})}),$(document).on("focus",".time",function(){$(this).datetimepicker({autoclose:1,startView:1,minView:0,maxView:1,showMeridian:1,format:"hh:ii",pickerPosition:"bottom-left"})}),$(document).on("focus",".date",function(e){e.stopPropagation(),$(this).datetimepicker({weekStart:1,todayBtn:1,autoclose:1,startView:2,minView:2,format:"yyyy-mm-dd",pickerPosition:"bottom-left"}).datetimepicker("show")}),$("input[readonly]").click(function(){$(this).select()}),$('[rel="tooltip"]').tooltip(),$("#filter select").change(function(){filter()}),$(".nav-collapse a[data-toggle]").click(function(){$(".nav-collapse").height("100%")}),$('[data-toggle="tab"]').on("click",function(e){e.preventDefault(),$(this).tab("show")}).on("shown.bs.tab",function(){}),$(".nav-tabs,.nav-pills").each(function(){$(this).find('[data-toggle="tab"]:first').tab("show")}),$(".help-block.error").closest(".form-group").addClass("has-error"),$(document).on("click",".list-group .label-trash",function(){$(this).parent().remove()}),$('[name="filter_username"],[name="filter_name"],[name="filter_email"],[name="filter_product"],[name="filter_model"],[name="filter_customer"]').each(function(){var e=$(this),t=e.data("target");e.typeahead({source:function(o,n){return $.getJSON("index.php?route="+e.data("url")+"/autocomplete&token="+token+"&filter_"+t+"="+encodeURIComponent(o),function(e){var o=[];return $.each(e,function(){o.push(this[t])}),n(o)})},updater:function(t){return e.val(t),filter(),t}}).attr("autocomplete","off").click(function(){e.select()})}).first().select();var t=$('input[name="path"]'),o={};t.typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/category/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.category_id,n.push(t.name)}),t(n)})},updater:function(e){return $('input[name="parent_id"]').val(o[e]),e}}).click(function(){this.select()});var o={};$("#return-customer").typeahead({source:function(e,t){return $.getJSON("index.php?route=people/customer/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t,n.push(t.name)}),t(n)})},updater:function(e){return $('input[name="customer"]').val(e),$('input[name="customer_id"]').val(o[e].customer_id),$('input[name="firstname"]').val(o[e].firstname),$('input[name="lastname"]').val(o[e].lastname),$('input[name="email"]').val(o[e].email),$('input[name="telephone"]').val(o[e].telephone),e}}).click(function(){this.select()});var o={};$("#return-product").typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/product/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t,n.push(t.name)}),t(n)})},updater:function(e){return $('input[name="product_id"]').val(o[e].product_id),$('input[name="model"]').val(o[e].model),e}}).click(function(){this.select()});var o={};$("#review-product").typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/product/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.product_id,n.push(t.name)}),t(n)})},updater:function(e){return $('input[name="product_id"]').val(o[e]),e}}).click(function(){this.select()});var o={};$('input[name="manufacturer"]').typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/manufacturer/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.manufacturer_id,n.push(t.name)}),t(n)})},updater:function(e){return $('input[name="manufacturer_id"]').val(o[e]),e}}),$('input[name="category"]').each(function(){var e=$(this),t=e.data("target"),o={};e.typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/category/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.category_id,n.push(t.name)}),t(n)})},updater:function(e){return $("#"+t+"-category"+o[e]).remove(),$("#"+t+"-category").append('<div class="list-group-item" id="'+t+"-category"+o[e]+'">'+e+'<a class="label label-danger label-trash"><i class="fa fa-trash-o fa-lg"></i></a><input type="hidden" name="'+t+'_category[]" value="'+o[e]+'"></div>'),null}})});var t=$('input[name="filter"]'),n=t.data("target"),o={};t.typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/filter/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.filter_id,n.push(t.name)}),t(n)})},updater:function(e){return $("#"+n+"-filter"+o[e]).remove(),$("#"+n+"-filter").append('<div class="list-group-item" id="'+n+"-filter"+o[e]+'">'+e+'<a class="label label-danger label-trash"><i class="fa fa-trash-o fa-lg"></i></a><input type="hidden" name="'+n+'_filter[]" value="'+o[e]+'"></div>'),null}});var o={};$('input[name="download"]').typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/download/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.download_id,n.push(t.name)}),t(n)})},updater:function(e){return $("#product-download"+o[e]).remove(),$("#product-download").append('<div class="list-group-item" id="product-download'+o[e]+'">'+e+'<a class="label label-danger label-trash"><i class="fa fa-trash-o fa-lg"></i></a><input type="hidden" name="product_download[]" value="'+o[e]+'"></div>'),null}});var o={};$('input[name="related"]').typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/product/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.product_id,n.push(t.name)}),t(n)})},updater:function(e){return $("#product-related"+o[e]).remove(),$("#product-related").append('<div class="list-group-item" id="product-related'+o[e]+'">'+e+'<a class="label label-danger label-trash"><i class="fa fa-trash-o fa-lg"></i></a><input type="hidden" name="product_related[]" value="'+o[e]+'"></div>'),null}});var o={};$('input[name="postrelated"]').typeahead({source:function(e,t){return $.getJSON("index.php?route=content/post/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.post_id,n.push(t.name)}),t(n)})},updater:function(e){return $("#post-related"+o[e]).remove(),$("#post-related").append('<div class="list-group-item" id="post-related'+o[e]+'">'+e+'<a class="label label-danger label-trash"><i class="fa fa-trash-o fa-lg"></i></a><input type="hidden" name="post_related[]" value="'+o[e]+'"></div>'),null}});var o={};$('input[name="post"]').typeahead({source:function(e,t){return $.getJSON("index.php?route=content/post/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.post_id,n.push(t.name)}),t(n)})},updater:function(e){return $('input[name="post_id"]').val(o[e]),e}});var o={};$('input[name="products"]').typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/product/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.product_id,n.push(t.name)}),t(n)})},updater:function(e){return $("#product"+o[e]).remove(),$("#product").append('<div class="list-group-item" id="product'+o[e]+'">'+e+'<a class="label label-danger label-trash"><i class="fa fa-trash-o fa-lg"></i></a><input type="hidden" name="product[]" value="'+o[e]+'"></div>'),null}});var o={};$('input[name="coupon_products"]').typeahead({source:function(e,t){return $.getJSON("index.php?route=catalog/product/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.product_id,n.push(t.name)}),t(n)})},updater:function(e){return $("#coupon-product"+o[e]).remove(),$("#coupon-product").append('<div class="list-group-item" id="coupon-product'+o[e]+'">'+e+'<a class="label label-danger label-trash"><i class="fa fa-trash-o fa-lg"></i></a><input type="hidden" name="coupon_product[]" value="'+o[e]+'"></div>'),null}});var o={};$('input[name="affiliates"]').typeahead({source:function(e,t){return $.getJSON("index.php?route=people/affiliate/autocomplete&token="+token+"&filter_name="+encodeURIComponent(e),function(e){var n=[];$.each(e,function(e,t){o[t.name]=t.affiliate_id,n.push(t.name)}),t(n)})},updater:function(e){return $("#affiliate"+o[e]).remove(),$("#affiliate").append('<div class="list-group-item" id="affiliate'+o[e]+'">'+e+'<a class="label label-danger label-trash"><i class="fa fa-trash-o fa-lg"></i></a><input type="hidden" name="affiliate[]" value="'+o[e]+'"></div>'),null}})}),$(function(){$("#attribute tr").each(function(e){attributeautocomplete(e)}),$("#button-history").click(function(){var e=$(this),t=e.data("action"),o=e.data("id");$.ajax({url:"index.php?route=sale/"+t+"/history&token="+token+"&"+t+"_id="+o,type:"post",dataType:"html",data:t+"_status_id="+encodeURIComponent($('select[name="'+t+'_status_id"]').val())+"&notify="+encodeURIComponent($('input[name="notify"]').attr("checked")?1:0)+"&append="+encodeURIComponent($('input[name="append"]').attr("checked")?1:0)+"&comment="+encodeURIComponent($('textarea[name="comment"]').val()),beforeSend:function(){e.button("loading").append($("<i>",{"class":"icon-loading"}))},complete:function(){e.button("reset")},success:function(e){$("#history").html(e),$('textarea[name="comment"]').val(""),$("#"+t+"-status").html($('select[name="'+t+'_status_id"] option:selected').text())}})});var e=$("#history");$(document).on("click","#history .pagination a",function(e){e.preventDefault(),$("#history").load(this.href)}),e.load(e.data("href"));var e=$("#transaction");$(document).on("click","#transaction .pagination a",function(e){e.preventDefault(),$("#transaction").load(this.href)}),e.load(e.data("href")),$("#tab-transaction input,#tab-reward input").on("keypress",function(e){13==e.keyCode&&(e.preventDefault(),$(this).closest(".tab-pane").find('button[type="button"]').click())}),$(document).on("click","#button-transaction",function(){var e=$(this),t=e.data("target");$.ajax({url:"index.php?route=sale/"+t+"/transaction&token="+token+"&"+t+"_id="+e.data("id"),type:"post",dataType:"html",data:"description="+encodeURIComponent($('#tab-transaction input[name="description"]').val())+"&amount="+encodeURIComponent($('#tab-transaction input[name="amount"]').val()),beforeSend:function(){e.button("loading").append($("<i>",{"class":"icon-loading"}))},complete:function(){e.button("reset")},success:function(e){$("#transaction").html(e),$('#tab-transaction input[name="amount"],#tab-transaction input[name="description"]').val("")}})});var e=$("#reward");$(document).on("click","#reward .pagination a",function(t){t.preventDefault(),e.load(this.href)}),e.load(e.data("href")),$(document).on("click","#info-slug-btn",function(){var e=getURLVar("page_id"),t=$('#language1 input[name="page_description[1][title]"]').val();$url="index.php?route=content/page/slug&token="+token+"&name="+encodeURIComponent(t),e&&($url+="&page_id="+e),$.ajax({url:$url,type:"get",dataType:"json",success:function(e){e.error?alertMessage("danger",e.error):$("#slug").val(e.slug)}})}),$(document).on("click","#cat-slug-btn",function(){var e=getURLVar("category_id"),t=$('#language1 input[name="category_description[1][name]"]').val();$url="index.php?route=catalog/category/slug&token="+token+"&name="+encodeURIComponent(t),e&&($url+="&category_id="+e),$.ajax({url:$url,type:"get",dataType:"json",success:function(e){e.error?alertMessage("danger",e.error):$("#slug").val(e.slug)}})}),$(document).on("click","#product-slug-btn",function(){var e=getURLVar("product_id"),t=$('#language1 input[name="product_description[1][name]"]').val();$url="index.php?route=catalog/product/slug&token="+token+"&name="+encodeURIComponent(t),e&&($url+="&product_id="+e),$.ajax({url:$url,type:"get",dataType:"json",success:function(e){e.error?alertMessage("danger",e.error):$("#slug").val(e.slug)}})}),$(document).on("click","#man-slug-btn",function(){var e=getURLVar("manufacturer_id"),t=$('input[name="name"]').val();$url="index.php?route=catalog/manufacturer/slug&token="+token+"&name="+encodeURIComponent(t),e&&($url+="&manufacturer_id="+e),$.ajax({url:$url,type:"get",dataType:"json",success:function(e){e.error?alertMessage("danger",e.error):$("#slug").val(e.slug)}})}),$(document).on("click","#blog-cat-slug-btn",function(){var e=getURLVar("category_id"),t=$('#language1 input[name="category_description[1][name]"]').val();$url="index.php?route=content/category/slug&token="+token+"&name="+encodeURIComponent(t),e&&($url+="&category_id="+e),$.ajax({url:$url,type:"get",dataType:"json",success:function(e){e.error?alertMessage("danger",e.error):$("#slug").val(e.slug)}})}),$(document).on("click","#post-slug-btn",function(){var e=getURLVar("post_id"),t=$('#language1 input[name="post_description[1][name]').val();$url="index.php?route=content/post/slug&token="+token+"&name="+encodeURIComponent(t),e&&($url+="&post_id="+e),$.ajax({url:$url,type:"get",dataType:"json",success:function(e){e.error?alertMessage("danger",e.error):$("#slug").val(e.slug)}})})});var alertMessage=function(e,t){var o='<div class="alert alert-'+e+' alert-dismissable" style="display:none;"><a class="close" data-dismiss="alert" href="#">&times;</a>'+t+"</div>";$("#notification").html(o),$("#notification>.alert").fadeIn("slow").delay(8e3).fadeTo(2e3,0,function(){$(this).remove()})};$(function(){$("#invoice-generate").click(function(){$.ajax({url:"index.php?route=sale/order/createinvoiceno&token="+token+"&order_id="+getURLVar("order_id"),dataType:"json",beforeSend:function(){$("#invoice-generate").button("loading").append($("<i>",{"class":"icon-loading"}))},success:function(e){e.error&&($("#invoice-generate").button("reset"),alertMessage("danger",e.error)),e.invoice_no&&$("#invoice").html(e.invoice_no)}})})}),$(function(){var e={};$("#order-customer").typeahead({source:function(t,o){return $.getJSON("index.php?route=people/customer/autocomplete&token="+token+"&filter_name="+encodeURIComponent(t),function(t){var n=[];$.each(t,function(t,o){e[o.name]=o,n.push(o.name)}),o(n)})},updater:function(t){$('input[name="customer"]').val(t),$('input[name="customer_id"]').val(e[t].customer_id),$('input[name="firstname"]').val(e[t].firstname),$('input[name="lastname"]').val(e[t].lastname),$('input[name="email"]').val(e[t].email),$('input[name="telephone"]').val(e[t].telephone),html='<option value="0">&mdash;</option>';for(i in e[t].address)html+='<option value="'+e[t].address[i].address_id+'">'+e[t].address[i].firstname+" "+e[t].address[i].lastname+","+e[t].address[i].address_1+","+e[t].address[i].city+","+e[t].address[i].country+"</option>";return $('select[name="shipping_address"]').html(html),$('select[name="payment_address"]').html(html),$('select[id="customer_group_id"]').button("reset").val(e[t].customer_group_id).change().button("loading"),t}}).click(function(){this.select()}),$("select[data-param]").on("change",function(){var e=$(this),t=e.data("param");$.ajax({url:"index.php?route=people/affiliate/country&token="+token+"&country_id="+e.val(),dataType:"json",beforeSend:function(){e.after($("<i>",{"class":"icon-loading"}))},complete:function(){$(".icon-loading").remove()},success:function(e){if(1==e.postcode_required?$("#postcode-required").show():$("#postcode-required").hide(),""!=e.zone)for(html='<option value="">'+t.select+"</option>",i=0;i<e.zone.length;i++)html+='<option value="'+e.zone[i].zone_id+'"',e.zone[i].zone_id==t.zone_id&&(html+=' selected=""'),html+=">"+e.zone[i].name+"</option>";else html='<option value="0" selected="">'+t.none+"</option>";$('select[name="zone_id"]').html(html)}})}),$('select[name="country_id"]').change();var t=$("#text_select").val(),o=$("#text_none").val(),n=$("#text_no_results").val(),a=$("#button_remove").val();$('[data-provide="countries"]').on("change",function(){var e=$(this),n=e.data("target");$.ajax({url:"index.php?route=sale/order/country&token="+token+"&country_id="+this.value,dataType:"json",beforeSend:function(){e.after($("<i>",{"class":"icon-loading"}))},complete:function(){$(".icon-loading").remove()},success:function(a){if($(".icon-loading").remove(),"1"==a.postcode_required?$("#"+n+"-postcode-required").show():$("#"+n+"-postcode-required").hide(),html='<option value="">'+t+"</option>",""!=a&&""!=a.zone)for(i=0;i<a.zone.length;i++)html+='<option value="'+a.zone[i].zone_id+'"',a.zone[i].zone_id==e.data("selected")&&(html+=' selected=""'),html+=">"+a.zone[i].name+"</option>";else html+='<option value="0" selected="">'+o+"</option>";$('select[name="'+n+'_zone_id"]').html(html)}})}),$('[data-provide="countries"]').change(),$('select[name="config_country_id"]').on("change",function(){var e=$(this);$.ajax({url:"index.php?route=setting/setting/country&token="+token+"&country_id="+this.value,dataType:"json",beforeSend:function(){e.after($("<i>",{"class":"icon-loading"}))},complete:function(){$(".icon-loading").remove()},success:function(t){if(html='<option value="">&ndash;</option>',t.zone+"")for(i=0;i<t.zone.length;i++)html+='<option value="'+t.zone[i].zone_id+'"',t.zone[i].zone_id==e.data("id")&&(html+=' selected=""'),html+=">"+t.zone[i].name+"</option>";else html+='<option value="0" selected="">'+e.data("none")+"</option>";$('select[name="config_zone_id"]').html(html)}})}),$('select[name="config_country_id"]').change(),$('select[name="config_theme"]').change(),$('select[name="config_admin_theme"]').change(),$(document).on("change",'select[name="payment_address"]',function(){$.ajax({url:"index.php?route=people/customer/address&token="+token+"&address_id="+this.value,dataType:"json",success:function(e){""!=e&&($('input[name="payment_firstname"]').val(e.firstname),$('input[name="payment_lastname"]').val(e.lastname),$('input[name="payment_company"]').val(e.company),$('input[name="payment_company_id"]').val(e.company_id),$('input[name="payment_tax_id"]').val(e.tax_id),$('input[name="payment_address_1"]').val(e.address_1),$('input[name="payment_address_2"]').val(e.address_2),$('input[name="payment_city"]').val(e.city),$('input[name="payment_postcode"]').val(e.postcode),$('select[name="payment_country_id"]').val(e.country_id),$('select[name="payment_country_id"]').data("selected",e.zone_id).change())}})}),$(document).on("change",'select[name="shipping_address"]',function(){$.ajax({url:"index.php?route=people/customer/address&token="+token+"&address_id="+this.value,dataType:"json",success:function(e){""!=e&&($('input[name="shipping_firstname"]').val(e.firstname),$('input[name="shipping_lastname"]').val(e.lastname),$('input[name="shipping_company"]').val(e.company),$('input[name="shipping_address_1"]').val(e.address_1),$('input[name="shipping_address_2"]').val(e.address_2),$('input[name="shipping_city"]').val(e.city),$('input[name="shipping_postcode"]').val(e.postcode),$('select[name="shipping_country_id"]').val(e.country_id),$("#shipping_zone_id").val(e.zone_id),$('select[name="shipping_country_id"]').data("selected",e.zone_id).change())}})}),$('select[name="payment"]').bind("change",function(){$('input[name="payment_method"]').val(this.value?$('select[name="payment"] option:selected').text():""),$('input[name="payment_code"]').val(this.value)}),$('select[name="shipping"]').bind("change",function(){$('input[name="shipping_method"]').val(this.value?$('select[name="shipping"] option:selected').text():""),$('input[name="shipping_code"]').val(this.value)});var e={};$('input[name="affiliate"]').typeahead({source:function(t,o){return $.getJSON("index.php?route=people/affiliate/autocomplete&token="+token+"&filter_name="+encodeURIComponent(t),function(t){var n=[];$.each(t,function(t,o){e[o.name]=o.affiliate_id,n.push(o.name)}),o(n)})},updater:function(t){return $('input[name="affiliate_id"]').val(e[t]),t}});var r=$("#order-product"),e={};r.typeahead({source:function(t,o){return $.getJSON("index.php?route=catalog/product/autocomplete&token="+token+"&filter_name="+encodeURIComponent(t),function(t){var n=[];$.each(t,function(t,o){e[o.name]=o,n.push(o.name)}),o(n)})},updater:function(t){if($('input[name="product_id"]').val(e[t].product_id),""!=e[t].option){var o="",n=$("#text_select").val();for(i=0;i<e[t].option.length;i++){var a=e[t].option[i];if(o+='<div class="form-group" id="option-'+a.product_option_id+'">',o+='<label class="control-label col-sm-2">',1==a.required&&(o+='<b class="required">*</b> '),o+=a.name+":</label>",o+='<div class="control-field col-sm-4">',"select"==a.type){for(o+='<select name="option['+a.product_option_id+']" class="form-control">',o+='<option value="">'+n+"</option>",j=0;j<a.option_value.length;j++)ov=a.option_value[j],o+='<option value="'+ov.product_option_value_id+'">'+ov.name,ov.price&&(o+=" ("+ov.price_prefix+ov.price+")"),o+="</option>";o+="</select>"}else if("radio"==a.type)for(j=0;j<a.option_value.length;j++)ov=a.option_value[j],o+='<div class="radio"><label for="option-value-'+ov.product_option_value_id+'">',o+='<input type="radio" name="option['+a.product_option_id+'][]" value="'+ov.product_option_value_id+'" id="option-value-'+ov.product_option_value_id+'">',o+=ov.name,ov.price&&(o+=" ("+ov.price_prefix+ov.price+")"),o+="</label></div>";else if("checkbox"==a.type)for(j=0;j<a.option_value.length;j++)ov=a.option_value[j],o+='<div class="checkbox"><label for="option-value-'+ov.product_option_value_id+'">',o+='<input type="checkbox" name="option['+a.product_option_id+'][]" value="'+ov.product_option_value_id+'" id="option-value-'+ov.product_option_value_id+'">',o+=ov.name,ov.price&&(o+=" ("+ov.price_prefix+ov.price+")"),o+="</label></div>";else if("image"==a.type){for(o+='<select name="option['+a.product_option_id+']" class="form-control">',o+='<option value="">'+n+"</option>",j=0;j<a.option_value.length;j++)ov=a.option_value[j],o+='<option value="'+ov.product_option_value_id+'">'+ov.name,ov.price&&(o+=" ("+ov.price_prefix+ov.price+")"),o+="</option>";o+="</select>"}else"text"==a.type?o+='<input type="text" name="option['+a.product_option_id+']" value="'+a.option_value+'" class="form-control">':"textarea"==a.type?o+='<textarea name="option['+a.product_option_id+']" class="form-control" rows="4">'+a.option_value+"</textarea>":"file"==a.type?(o+='<button type="button" id="button-option-'+a.product_option_id+'" class="btn btn-default"><i class="fa fa-upload"></i> '+$("#button_upload").val()+"</button>",o+='<input type="hidden" name="option['+a.product_option_id+']" value="'+a.option_value+'" id="input-option-'+a.product_option_id+'">'):"date"==a.type?(o+='<label class="input-group">',o+='<input type="text" name="option['+a.product_option_id+']" value="'+a.option_value+'" data-provide="datetimepicker" class="form-control" autocomplete="off">',o+='<span class="input-group-addon"><i class="fa fa-calendar"></i></span>',o+="</label>"):"datetime"==a.type?(o+='<label class="input-group">',o+='<input type="text" name="option['+a.product_option_id+']" value="'+a.option_value+'" data-provide="datetimepicker" class="form-control" data-show-meridian="1" data-date-today-btn="1" data-min-view="0" data-date-format="yyyy-mm-dd hh:mm" autocomplete="off">',o+='<span class="input-group-addon"><i class="fa fa-calendar"></i></span>',o+="</label>"):"time"==a.type&&(o+='<label class="input-group">',o+='<input type="text" name="option['+a.product_option_id+']" value="'+a.option_value+'" data-provide="datetimepicker" class="form-control" data-max-view="1" data-start-view="1" data-show-meridian="1" data-min-view="0" data-date-format="hh:ii" autocomplete="off">',o+='<span class="input-group-addon"><i class="fa fa-clock-o"></i></span>',o+="</label>");o+="</div>",o+="</div>"}for($("#option").html(o),i=0;i<e[t].option.length;i++)a=e[t].option[i],"file"==a.type&&$("#option").delegate('button[id^="button-option-"]',"click",function(){var e=$(this);$("#form-upload").remove(),$("body").prepend('<form enctype="multipart/form-data" id="form-upload" style="display:none;"><input type="file" name="file"></form>'),$('#form-upload input[name="file"]').on("change",function(){$.ajax({url:"index.php?route=sale/order/upload&token="+token,type:"post",dataType:"json",data:new FormData($(this).parent()[0]),cache:!1,contentType:!1,processData:!1,beforeSend:function(){e.button("loading").append($("<i>",{"class":"icon-loading"}))},complete:function(){e.button("reset")},success:function(t){$(".alert,.help-block.error").remove(),$(".has-error").removeClass("has-error"),t.error&&e.after('<div class="help-block error">'+t.error+"</div>").closest(".form-group").addClass("has-error"),t.success&&(alert(t.success),e.parent().find('input[name^="option"]').val(t.file))}})}).click()})}else $("#option .form-group").remove();return t}}).click(function(){this.select()}),$("#button-product,#button-voucher,#button-update").on("click",function(){var e=$(this);data='#tab-customer input[type="text"],#tab-customer input[type="hidden"],#tab-customer input[type="radio"]:checked,#tab-customer input[type="checkbox"]:checked,#tab-customer select,#tab-customer textarea,',data+='#tab-payment input[type="text"],#tab-payment input[type="hidden"],#tab-payment input[type="radio"]:checked,#tab-payment input[type="checkbox"]:checked,#tab-payment select,#tab-payment textarea,',data+='#tab-shipping input[type="text"],#tab-shipping input[type="hidden"],#tab-shipping input[type="radio"]:checked,#tab-shipping input[type="checkbox"]:checked,#tab-shipping select,#tab-shipping textarea,',data+="button-product"==e.attr("id")?'#tab-product input[type="text"],#tab-product input[type="hidden"],#tab-product input[type="radio"]:checked,#tab-product input[type="checkbox"]:checked,#tab-product select,#tab-product textarea,':'#product input[type="text"],#product input[type="hidden"],#product input[type="radio"]:checked,#product input[type="checkbox"]:checked,#product select,#product textarea,',data+="button-voucher"==e.attr("id")?'#tab-voucher input[type="text"],#tab-voucher input[type="hidden"],#tab-voucher input[type="radio"]:checked,#tab-voucher input[type="checkbox"]:checked,#tab-voucher select,#tab-voucher textarea,':'#voucher input[type="text"],#voucher input[type="hidden"],#voucher input[type="radio"]:checked,#voucher input[type="checkbox"]:checked,#voucher select,#voucher textarea,',data+='#tab-total input[type="text"],#tab-total input[type="hidden"],#tab-total input[type="radio"]:checked,#tab-total input[type="checkbox"]:checked,#tab-total select,#tab-total textarea',$.ajax({url:$("#store_url").val()+"index.php?route=checkout/manual&token="+token,type:"post",data:$(data),dataType:"json",beforeSend:function(){$(".alert,.text-error").remove(),e.button("loading").append($("<i>",{"class":"icon-loading"}))},success:function(o){if($(".alert,.help-block.error").remove(),$(".has-error").removeClass("has-error"),e.button("reset"),o.error){if(o.error.warning&&alertMessage("danger",o.error.warning),o.error.customer&&alertMessage("danger",o.error.customer),o.error.firstname&&$('input[name="firstname"]').after('<div class="help-block error">'+o.error.firstname+"</div>"),o.error.lastname&&$('input[name="lastname"]').after('<div class="help-block error">'+o.error.lastname+"</div>"),o.error.email&&$('input[name="email"]').after('<div class="help-block error">'+o.error.email+"</div>"),o.error.telephone&&$('input[name="telephone"]').after('<div class="help-block error">'+o.error.telephone+"</div>"),o.error.payment&&$.each(o.error.payment,function(e,t){$('[name^="payment_'+e+'"]').after('<div class="help-block error">'+t+"</div>")}),o.error.shipping&&$.each(o.error.shipping,function(e,t){$('[name^="shipping_'+e+'"]').after('<div class="help-block error">'+t+"</div>")
}),o.error.product){if(o.error.product.option)for(i in o.error.product.option)$("#option-"+i+" .controls").append('<div class="help-block error">'+o.error.product.option[i]+"</div>");if(o.error.product.stock&&alertMessage("danger",o.error.product.stock),o.error.product.minimum)for(i in o.error.product.minimum)alertMessage("danger",o.error.product.minimum[i])}else $('input[name="product"],input[name="product_id"]').val(""),$("#option .form-group").remove(),$('input[name="quantity"]').val("1");o.error.vouchers?$.each(o.error.vouchers,function(e,t){$('input[name="'+e+'"]').after('<div class="help-block error">'+t+"</div>")}):($('input[name="from_name"],input[name="from_email"],input[name="to_name"],input[name="to_email"],textarea[name="message"]').val(""),$('input[name="amount"]').val("25.00")),$(".help-block.error").closest(".form-group").addClass("has-error"),o.error.shipping_method&&alertMessage("danger",o.error.shipping_method),o.error.payment_method&&alertMessage("danger",o.error.payment_method),o.error.coupon&&alertMessage("danger",o.error.coupon),o.error.voucher&&alertMessage("danger",o.error.voucher),o.error.reward&&alertMessage("danger",o.error.reward)}else $('input[name="product"],input[name="product_id"],input[name="from_name"],input[name="from_email"],input[name="to_name"],input[name="to_email"],textarea[name="message"]').val(""),$("#option .form-group").remove(),$('input[name="quantity"]').val("1"),$('input[name="amount"]').val("25.00");if(o.success&&alertMessage("success",o.success),""!=o.order_product){var r=0,c=0,d=0;for(html="",i=0;i<o.order_product.length;i++){if(product=o.order_product[i],html+='<tr id="product-row'+r+'">',html+='<td class="text-center"><a class="label label-danger" title="'+a+'" onclick="$("#product-row'+r+'").remove();$("#button-update").trigger("click");"><i class="fa fa-trash-o fa-lg"></i></a></td>',html+="<td>"+product.name+'<br><input type="hidden" name="order_product['+r+'][order_product_id]" value=""><input type="hidden" name="order_product['+r+'][product_id]" value="'+product.product_id+'"><input type="hidden" name="order_product['+r+'][name]" value="'+product.name+'">',product.option)for(j=0;j<product.option.length;j++)option=product.option[j],html+='<div class="help">'+option.name+":"+option.value+"</div>",html+='<input type="hidden" name="order_product['+r+"][order_option]["+c+'][order_option_id]" value="'+option.order_option_id+'">',html+='<input type="hidden" name="order_product['+r+"][order_option]["+c+'][product_option_id]" value="'+option.product_option_id+'">',html+='<input type="hidden" name="order_product['+r+"][order_option]["+c+'][product_option_value_id]" value="'+option.product_option_value_id+'">',html+='<input type="hidden" name="order_product['+r+"][order_option]["+c+'][name]" value="'+option.name+'">',html+='<input type="hidden" name="order_product['+r+"][order_option]["+c+'][value]" value="'+option.value+'">',html+='<input type="hidden" name="order_product['+r+"][order_option]["+c+'][type]" value="'+option.type+'">',c++;if(product.download)for(j=0;j<product.download.length;j++)download=product.download[j],html+='<input type="hidden" name="order_product['+r+"][order_download]["+d+'][order_download_id]" value="'+download.order_download_id+'">',html+='<input type="hidden" name="order_product['+r+"][order_download]["+d+'][name]" value="'+download.name+'">',html+='<input type="hidden" name="order_product['+r+"][order_download]["+d+'][filename]" value="'+download.filename+'">',html+='<input type="hidden" name="order_product['+r+"][order_download]["+d+'][mask]" value="'+download.mask+'">',html+='<input type="hidden" name="order_product['+r+"][order_download]["+d+'][remaining]" value="'+download.remaining+'">',d++;html+="</td>",html+="<td>"+product.model+'<input type="hidden" name="order_product['+r+'][model]" value="'+product.model+'"></td>',html+='<td class="text-right">'+product.quantity+'<input type="hidden" name="order_product['+r+'][quantity]" value="'+product.quantity+'"></td>',html+='<td class="text-right">'+product.price+'<input type="hidden" name="order_product['+r+'][price]" value="'+product.price+'"></td>',html+='<td class="text-right">'+product.total+'<input type="hidden" name="order_product['+r+'][total]" value="'+product.total+'"><input type="hidden" name="order_product['+r+'][tax]" value="'+product.tax+'"><input type="hidden" name="order_product['+r+'][reward]" value="'+product.reward+'"></td>',html+="</tr>",r++}$("#product").html(html)}else $("#product").html('<tr><td colspan="6" class="text-center">'+n+"</td></tr>");if(""!=o.order_voucher){var u=0;html="";for(i in o.order_voucher)voucher=o.order_voucher[i],html+='<tr id="voucher-row'+u+'">',html+='<td class="text-center"><a title="'+a+'" onclick="$("#voucher-row'+u+'").remove();$("#button-update").trigger("click");"><i class="fa fa-trash-o fa-lg"></i></a></td>',html+="<td>"+voucher.description,html+='<input type="hidden" name="order_voucher['+u+'][order_voucher_id]" value="">',html+='<input type="hidden" name="order_voucher['+u+'][voucher_id]" value="'+voucher.voucher_id+'">',html+='<input type="hidden" name="order_voucher['+u+'][description]" value="'+voucher.description+'">',html+='<input type="hidden" name="order_voucher['+u+'][code]" value="'+voucher.code+'">',html+='<input type="hidden" name="order_voucher['+u+'][from_name]" value="'+voucher.from_name+'">',html+='<input type="hidden" name="order_voucher['+u+'][from_email]" value="'+voucher.from_email+'">',html+='<input type="hidden" name="order_voucher['+u+'][to_name]" value="'+voucher.to_name+'">',html+='<input type="hidden" name="order_voucher['+u+'][to_email]" value="'+voucher.to_email+'">',html+='<input type="hidden" name="order_voucher['+u+'][voucher_theme_id]" value="'+voucher.voucher_theme_id+'">',html+='<input type="hidden" name="order_voucher['+u+'][message]" value="'+voucher.message+'">',html+='<input type="hidden" name="order_voucher['+u+'][amount]" value="'+voucher.amount+'">',html+="</td>",html+="<td></td>",html+='<td class="text-right">1</td>',html+='<td class="text-right">'+voucher.amount+"</td>",html+='<td class="text-right">'+voucher.amount+"</td>",html+="</tr>",u++;$("#voucher").html(html)}else $("#voucher").html('<tr><td colspan="6" class="text-center">'+n+"</td></tr>");if(""!=o.order_product||""!=o.order_voucher||""!=o.order_total){if(html="",""!=o.order_product)for(i=0;i<o.order_product.length;i++){if(product=o.order_product[i],html+="<tr>",html+="<td>"+product.name,product.option)for(j=0;j<product.option.length;j++)option=product.option[j],html+='<div class="help">'+option.name+":"+option.value+"</div>";html+="</td>",html+="<td>"+product.model+"</td>",html+='<td class="text-right">'+product.quantity+"</td>",html+='<td class="text-right">'+product.price+"</td>",html+='<td class="text-right">'+product.total+"</td>",html+="</tr>"}if(""!=o.order_voucher)for(i in o.order_voucher)voucher=o.order_voucher[i],html+="<tr>",html+="<td>"+voucher.description+"</td>",html+="<td></td>",html+='<td class="text-right">1</td>',html+='<td class="text-right">'+voucher.amount+"</td>",html+='<td class="text-right">'+voucher.amount+"</td>",html+="</tr>";var l=0;for(i in o.order_total)total=o.order_total[i],html+='<tr id="total-row'+l+'">',html+='<td class="text-right" colspan="4"><input type="hidden" name="order_total['+l+'][order_total_id]" value=""><input type="hidden" name="order_total['+l+'][code]" value="'+total.code+'"><input type="hidden" name="order_total['+l+'][title]" value="'+total.title+'"><input type="hidden" name="order_total['+l+'][text]" value="'+total.text+'"><input type="hidden" name="order_total['+l+'][value]" value="'+total.value+'"><input type="hidden" name="order_total['+l+'][sort_order]" value="'+total.sort_order+'">'+total.title+":</td>",html+='<td class="text-right">'+total.value+"</td>",html+="</tr>",l++;$("#total").html(html)}else $("#total").html('<tr><td colspan="6" class="text-center">'+n+"</td></tr>");if(o.shipping_method){html='<option value="">'+t+"</option>";for(i in o.shipping_method){if(html+='<optgroup label="'+o.shipping_method[i].title+'">',o.shipping_method[i].error)html+='<option value="" class="text-error" disabled="">'+o.shipping_method[i].error+"</option>";else for(j in o.shipping_method[i].quote)html+=o.shipping_method[i].quote[j].code==$('input[name="shipping_code"]').val()?'<option value="'+o.shipping_method[i].quote[j].code+'" selected="">'+o.shipping_method[i].quote[j].title+"</option>":'<option value="'+o.shipping_method[i].quote[j].code+'">'+o.shipping_method[i].quote[j].title+"</option>";html+="</optgroup>"}$('select[name="shipping"]').html(html),$('input[name="shipping_method"]').val($('select[name="shipping"] option:selected').val()?$('select[name="shipping"] option:selected').text():""),$('input[name="shipping_code"]').val($('select[name="shipping"] option:selected').val())}if(o.payment_method){html='<option value="">'+t+"</option>";for(i in o.payment_method)html+=o.payment_method[i].code==$('input[name="payment_code"]').val()?'<option value="'+o.payment_method[i].code+'" selected="">'+o.payment_method[i].title+"</option>":'<option value="'+o.payment_method[i].code+'">'+o.payment_method[i].title+"</option>";$('select[name="payment"]').html(html),$('input[name="payment_method"]').val($('select[name="payment"] option:selected').val()?$('select[name="payment"] option:selected').text():""),$('input[name="payment_code"]').val($('select[name="payment"] option:selected').val())}}})})}),$(document).on("click","#button-upload",function(){var e=$(this);$("#form-upload").remove(),$("body").prepend('<form enctype="multipart/form-data" id="form-upload" style="display:none;"><input type="file" name="file"></form>'),$('#form-upload input[name="file"]').on("change",function(){$.ajax({url:"index.php?route=catalog/download/upload&token="+token,type:"post",dataType:"json",data:new FormData($(this).parent()[0]),cache:!1,contentType:!1,processData:!1,beforeSend:function(){e.button("loading").append($("<i>",{"class":"icon-loading"}))},complete:function(){e.button("reset")},success:function(e){e.error&&alert(e.error),e.success&&(alert(e.success),$('input[name="filename"]').val(e.filename),$('input[name="mask"]').val(e.mask))}})}).click()}),$(document).on("click","#button-send",function(){var e=$(this);for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();$.ajax({url:e.data("url"),type:"post",data:$("select,input,textarea"),dataType:"json",beforeSend:function(){e.button("loading").append($("<i>",{"class":"icon-loading"}))},complete:function(){e.button("reset")},success:function(e){$(".alert,.help-block.error").remove(),$(".has-error").removeClass("has-error"),e.error&&(e.error.warning&&alertMessage("danger",e.error.warning),e.error.subject&&$('input[name="subject"]').after('<span class="help-block error">'+e.error.subject+"</span>").closest(".form-group").addClass("has-error"),e.error.message&&$("#message").parent().append('<span class="help-block error">'+e.error.message+"</span>").closest(".form-group").addClass("has-error")),e.success&&(alertMessage("success",e.success),e.next&&send(e.next))}})}),$(function(){$('select[name="to"]').bind("change",function(){$("#mail .to").hide(),$("#mail #to-"+$(this).val().replace("_","-")).show().find('input[type="text"]').select()}),$('select[name="to"]').change();var e={};$('input[name="customers"]').typeahead({source:function(t,o){return $.getJSON("index.php?route=people/customer/autocomplete&token="+token+"&filter_name="+encodeURIComponent(t),function(t){var n=[];$.each(t,function(t,o){e[o.name]=o.customer_id,n.push(o.name)}),o(n)})},updater:function(t){return $("#customer"+e[t]).remove(),$("#customer").append('<div class="list-group-item" id="customer'+e[t]+'"><a class="label label-danger label-trash"><i class="fa fa-trash-o fa-lg"></i></a>'+t+'<input type="hidden" name="customer[]" value="'+e[t]+'"></div>'),null}})}),$.fn.tabs=function(){var e=$(this);this.each(function(){var t=$(this);$(t.attr("href")).hide(),t.click(function(){return e.removeClass("selected").each(function(e,t){$($(t).attr("href")).hide()}),$(this).addClass("selected"),$($(this).attr("href")).show(),!1})}),e.show().first().click()};