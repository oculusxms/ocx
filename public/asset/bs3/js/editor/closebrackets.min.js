!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t){var r=e.getRange(a(t.line,t.ch-1),a(t.line,t.ch+1));return 2==r.length?r:null}function r(t,r,n){var i=t.getLine(r.line),o=t.getTokenAt(r);if(/\bstring2?\b/.test(o.type))return!1;var l=new e.StringStream(i.slice(0,r.ch)+n+i.slice(r.ch),4);for(l.pos=l.start=o.start;;){var s=t.getMode().token(l,o.state);if(l.pos>=r.ch+1)return/\bstring2?\b/.test(s);l.start=l.pos}}function n(n){for(var i={name:"autoCloseBrackets",Backspace:function(r){if(r.getOption("disableInput"))return e.Pass;for(var i=r.listSelections(),o=0;o<i.length;o++){if(!i[o].empty())return e.Pass;var l=t(r,i[o].head);if(!l||n.indexOf(l)%2!=0)return e.Pass}for(var o=i.length-1;o>=0;o--){var s=i[o].head;r.replaceRange("",a(s.line,s.ch-1),a(s.line,s.ch+1))}}},o="",l=0;l<n.length;l+=2)(function(t,n){t!=n&&(o+=n),i["'"+t+"'"]=function(i){if(i.getOption("disableInput"))return e.Pass;for(var l,u,c=i.listSelections(),f=0;f<c.length;f++){var h,d=c[f],p=d.head,u=i.getRange(p,a(p.line,p.ch+1));if(d.empty())if(t==n&&u==n)h=i.getRange(p,a(p.line,p.ch+3))==t+t+t?"skipThree":"skip";else if(t==n&&p.ch>1&&i.getRange(a(p.line,p.ch-2),p)==t+t&&(p.ch<=2||i.getRange(a(p.line,p.ch-3),a(p.line,p.ch-2))!=t))h="addFour";else if('"'==t||"'"==t){if(e.isWordChar(u)||!r(i,p,t))return e.Pass;h="both"}else{if(!(i.getLine(p.line).length==p.ch||o.indexOf(u)>=0||s.test(u)))return e.Pass;h="both"}else h="surround";if(l){if(l!=h)return e.Pass}else l=h}i.operation(function(){if("skip"==l)i.execCommand("goCharRight");else if("skipThree"==l)for(var e=0;3>e;e++)i.execCommand("goCharRight");else if("surround"==l){for(var r=i.getSelections(),e=0;e<r.length;e++)r[e]=t+r[e]+n;i.replaceSelections(r,"around")}else"both"==l?(i.replaceSelection(t+n,null),i.execCommand("goCharLeft")):"addFour"==l&&(i.replaceSelection(t+t+t+t,"before"),i.execCommand("goCharRight"))})},t!=n&&(i["'"+n+"'"]=function(t){for(var r=t.listSelections(),i=0;i<r.length;i++){var o=r[i];if(!o.empty()||t.getRange(o.head,a(o.head.line,o.head.ch+1))!=n)return e.Pass}t.execCommand("goCharRight")})})(n.charAt(l),n.charAt(l+1));return i}function i(r){return function(n){if(n.getOption("disableInput"))return e.Pass;for(var i=n.listSelections(),o=0;o<i.length;o++){if(!i[o].empty())return e.Pass;var l=t(n,i[o].head);if(!l||r.indexOf(l)%2!=0)return e.Pass}n.operation(function(){n.replaceSelection("\n\n",null),n.execCommand("goCharLeft"),i=n.listSelections();for(var e=0;e<i.length;e++){var t=i[e].head.line;n.indentLine(t,null,!0),n.indentLine(t+1,null,!0)}})}}var o="()[]{}''\"\"",l="[]{}",s=/\s/,a=e.Pos;e.defineOption("autoCloseBrackets",!1,function(t,r,s){if(s!=e.Init&&s&&t.removeKeyMap("autoCloseBrackets"),r){var a=o,u=l;"string"==typeof r?a=r:"object"==typeof r&&(null!=r.pairs&&(a=r.pairs),null!=r.explode&&(u=r.explode));var c=n(a);u&&(c.Enter=i(u)),t.addKeyMap(c)}})});