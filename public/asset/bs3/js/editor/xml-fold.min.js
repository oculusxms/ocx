!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t){return e.line-t.line||e.ch-t.ch}function r(e,t,r,n){this.line=t,this.ch=r,this.cm=e,this.text=e.getLine(t),this.min=n?n.from:e.firstLine(),this.max=n?n.to-1:e.lastLine()}function n(e,t){var r=e.cm.getTokenTypeAt(h(e.line,t));return r&&/\btag\b/.test(r)}function i(e){return e.line>=e.max?void 0:(e.ch=0,e.text=e.cm.getLine(++e.line),!0)}function o(e){return e.line<=e.min?void 0:(e.text=e.cm.getLine(--e.line),e.ch=e.text.length,!0)}function l(e){for(;;){var t=e.text.indexOf(">",e.ch);if(-1==t){if(i(e))continue;return}{if(n(e,t+1)){var r=e.text.lastIndexOf("/",t),o=r>-1&&!/\S/.test(e.text.slice(r+1,t));return e.ch=t+1,o?"selfClose":"regular"}e.ch=t+1}}}function s(e){for(;;){var t=e.ch?e.text.lastIndexOf("<",e.ch-1):-1;if(-1==t){if(o(e))continue;return}if(n(e,t+1)){g.lastIndex=t,e.ch=t;var r=g.exec(e.text);if(r&&r.index==t)return r}else e.ch=t}}function a(e){for(;;){g.lastIndex=e.ch;var t=g.exec(e.text);if(!t){if(i(e))continue;return}{if(n(e,t.index+1))return e.ch=t.index+t[0].length,t;e.ch=t.index+1}}}function u(e){for(;;){var t=e.ch?e.text.lastIndexOf(">",e.ch-1):-1;if(-1==t){if(o(e))continue;return}{if(n(e,t+1)){var r=e.text.lastIndexOf("/",t),i=r>-1&&!/\S/.test(e.text.slice(r+1,t));return e.ch=t+1,i?"selfClose":"regular"}e.ch=t}}}function c(e,t){for(var r=[];;){var n,i=a(e),o=e.line,s=e.ch-(i?i[0].length:0);if(!i||!(n=l(e)))return;if("selfClose"!=n)if(i[1]){for(var u=r.length-1;u>=0;--u)if(r[u]==i[2]){r.length=u;break}if(0>u&&(!t||t==i[2]))return{tag:i[2],from:h(o,s),to:h(e.line,e.ch)}}else r.push(i[2])}}function f(e,t){for(var r=[];;){var n=u(e);if(!n)return;if("selfClose"!=n){var i=e.line,o=e.ch,l=s(e);if(!l)return;if(l[1])r.push(l[2]);else{for(var a=r.length-1;a>=0;--a)if(r[a]==l[2]){r.length=a;break}if(0>a&&(!t||t==l[2]))return{tag:l[2],from:h(e.line,e.ch),to:h(i,o)}}}else s(e)}}var h=e.Pos,d="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",p=d+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",g=new RegExp("<(/?)(["+d+"]["+p+"]*)","g");e.registerHelper("fold","xml",function(e,t){for(var n=new r(e,t.line,0);;){var i,o=a(n);if(!o||n.line!=t.line||!(i=l(n)))return;if(!o[1]&&"selfClose"!=i){var t=h(n.line,n.ch),s=c(n,o[2]);return s&&{from:t,to:s.from}}}}),e.findMatchingTag=function(e,n,i){var o=new r(e,n.line,n.ch,i);if(-1!=o.text.indexOf(">")||-1!=o.text.indexOf("<")){var a=l(o),u=a&&h(o.line,o.ch),d=a&&s(o);if(a&&"selfClose"!=a&&d&&!(t(o,n)>0)){var p={from:h(o.line,o.ch),to:u,tag:d[2]};return d[1]?{open:f(o,d[2]),close:p,at:"close"}:(o=new r(e,u.line,u.ch,i),{open:p,close:c(o,d[2]),at:"open"})}}},e.findEnclosingTag=function(e,t,n){for(var i=new r(e,t.line,t.ch,n);;){var o=f(i);if(!o)break;var l=new r(e,t.line,t.ch,n),s=c(l,o.tag);if(s)return{open:o,close:s}}},e.scanForClosingTag=function(e,t,n,i){var o=new r(e,t.line,t.ch,i?{from:0,to:i}:null);return c(o,n)}});