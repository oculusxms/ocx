!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}(function(e){function t(t){if(t.getOption("disableInput"))return e.Pass;for(var r=t.listSelections(),s=[],a=0;a<r.length;a++){if(!r[a].empty())return e.Pass;var u=r[a].head,c=t.getTokenAt(u),f=e.innerMode(t.getMode(),c.state),h=f.state;if("xml"!=f.mode.name||!h.tagName)return e.Pass;var d=t.getOption("autoCloseTags"),p="html"==f.mode.configuration,g="object"==typeof d&&d.dontCloseTags||p&&o,v="object"==typeof d&&d.indentTags||p&&l,m=h.tagName;c.end>u.ch&&(m=m.slice(0,m.length-c.end+u.ch));var y=m.toLowerCase();if(!m||"string"==c.type&&(c.end!=u.ch||!/[\"\']/.test(c.string.charAt(c.string.length-1))||1==c.string.length)||"tag"==c.type&&"closeTag"==h.type||c.string.indexOf("/")==c.string.length-1||g&&n(g,y)>-1||i(t,m,u,h,!0))return e.Pass;var b=v&&n(v,y)>-1;s[a]={indent:b,text:">"+(b?"\n\n":"")+"</"+m+">",newPos:b?e.Pos(u.line+1,0):e.Pos(u.line,u.ch+1)}}for(var a=r.length-1;a>=0;a--){var x=s[a];t.replaceRange(x.text,r[a].head,r[a].anchor,"+insert");var w=t.listSelections().slice(0);w[a]={head:x.newPos,anchor:x.newPos},t.setSelections(w),x.indent&&(t.indentLine(x.newPos.line,null,!0),t.indentLine(x.newPos.line+1,null,!0))}}function r(t){if(t.getOption("disableInput"))return e.Pass;for(var r=t.listSelections(),n=[],o=0;o<r.length;o++){if(!r[o].empty())return e.Pass;var l=r[o].head,s=t.getTokenAt(l),a=e.innerMode(t.getMode(),s.state),u=a.state;if("string"==s.type||"<"!=s.string.charAt(0)||s.start!=l.ch-1||"xml"!=a.mode.name||!u.context||!u.context.tagName||i(t,u.context.tagName,l,u))return e.Pass;n[o]="/"+u.context.tagName+">"}t.replaceSelections(n)}function n(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;n>r;++r)if(e[r]==t)return r;return-1}function i(t,r,n,i,o){if(!e.scanForClosingTag)return!1;var l=Math.min(t.lastLine()+1,n.line+500),s=e.scanForClosingTag(t,n,null,l);if(!s||s.tag!=r)return!1;for(var a=i.context,u=o?1:0;a&&a.tagName==r;a=a.prev)++u;n=s.to;for(var c=1;u>c;c++){var f=e.scanForClosingTag(t,n,null,l);if(!f||f.tag!=r)return!1;n=f.to}return!0}e.defineOption("autoCloseTags",!1,function(n,i,o){if(o!=e.Init&&o&&n.removeKeyMap("autoCloseTags"),i){var l={name:"autoCloseTags"};("object"!=typeof i||i.whenClosing)&&(l["'/'"]=function(e){return r(e)}),("object"!=typeof i||i.whenOpening)&&(l["'>'"]=function(e){return t(e)}),n.addKeyMap(l)}});var o=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],l=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"]});